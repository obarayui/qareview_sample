# レビューツールアプリケーション - セットアップ手順書

このドキュメントでは、レビューツールアプリケーションのセットアップ方法と使い方を説明します。

## 目次

1. [前提条件](#前提条件)
2. [ローカル環境でのセットアップ](#ローカル環境でのセットアップ)
3. [GitHub Pagesでの公開（推奨）](#github-pagesでの公開推奨)
4. [使い方](#使い方)
5. [データのエクスポート](#データのエクスポート)
6. [トラブルシューティング](#トラブルシューティング)

---

## 前提条件

- Webブラウザ（Chrome, Firefox, Safari, Edge など）
- （オプション）GitHubアカウント（GitHub Pagesで公開する場合）

---

## ローカル環境でのセットアップ

### 方法1: ローカルサーバーを使用（推奨）

ブラウザのセキュリティ制限により、直接HTMLファイルを開くとファイル読み込みに失敗する可能性があります。ローカルサーバーを使用することを推奨します。

#### Python 3を使用する場合

```bash
# プロジェクトディレクトリに移動
cd /path/to/qareview_sample

# ローカルサーバーを起動
python3 -m http.server 8000
```

ブラウザで `http://localhost:8000` にアクセスしてください。

#### Node.jsを使用する場合

```bash
# http-serverをインストール（初回のみ）
npm install -g http-server

# プロジェクトディレクトリに移動
cd /path/to/qareview_sample

# ローカルサーバーを起動
http-server -p 8000
```

ブラウザで `http://localhost:8000` にアクセスしてください。

### 方法2: 直接HTMLファイルを開く

一部のブラウザではセキュリティ制限により、ローカルファイルの読み込みが制限される場合があります。

1. `index.html` をブラウザにドラッグ&ドロップ
2. または、ブラウザのメニューから「ファイルを開く」で `index.html` を選択

**注意**: この方法では、問題セットの画像やJSONファイルが読み込めない場合があります。

---

## GitHub Pagesでの公開（推奨）

GitHub Pagesで公開すると、インターネット経由でアクセスでき、セキュリティ制限の問題も回避できます。

### 手順

1. **GitHubリポジトリの設定**

   - GitHubで `qareview_sample` リポジトリを開く
   - `Settings` タブをクリック
   - 左サイドバーの `Pages` をクリック

2. **ソースの設定**

   - `Source` セクションで `Deploy from a branch` を選択
   - `Branch` で以下を選択：
     - **ブランチ**: `main` （メインのコードが保存されているブランチ）
     - **フォルダ**: `/ (root)` （リポジトリの最上位フォルダから公開）
   - `Save` をクリック

   **補足**:
   - `/ (root)` は、`index.html`がリポジトリの最上位にあるため選択します
   - もし`docs`フォルダ内にファイルを配置した場合は、`/docs` を選択します

3. **アクセス**

   数分後、以下のURLでアクセスできます：
   ```
   https://<あなたのGitHubユーザー名>.github.io/qareview_sample/
   ```

4. **確認**

   - URLにアクセスして、ホーム画面が表示されることを確認
   - 問題セットを選択して、レビュー画面が正常に動作することを確認

---

## 使い方

### 1. ホーム画面

1. **レビューア名の入力**
   - あなたの名前を入力します

2. **問題セットの選択**
   - `tooltest001` または `tooltest002` のいずれかを選択
   - 「この問題セットを開始」ボタンをクリック

3. **カスタムURL（オプション）**
   - 独自のGitHubリポジトリから問題セットを読み込む場合に使用
   - 例: `https://github.com/username/repo/tree/main/folder`

### 2. レビュー画面

1. **問題の確認**
   - 画面上部に問題画像が表示されます
   - 問題文と4つの選択肢を確認します

2. **回答の選択**
   - 選択肢ボタンをクリックして回答を選択
   - 選択後、コメント欄が表示されます（任意）

3. **回答の提出**
   - 回答を選択したら「回答を提出」ボタンをクリック
   - 正解/不正解が即座に表示されます

4. **次の問題へ**
   - 「次の問題へ」ボタンをクリックして続行
   - 最後の問題の場合は「レビュー完了」ボタンが表示されます

5. **レビュー完了**
   - すべての問題が終わったら「レビュー完了」をクリック
   - あなたの正解率が表示されます

### 3. データの保存

レビュー結果は以下の2つの方法で保存できます：

#### 方法1: ローカルストレージ（デフォルト）
- 自動的にブラウザのローカルストレージに保存されます
- インターネット接続不要
- ブラウザ内のみでデータが保存されます

#### 方法2: AWS S3（クラウド保存）
- レビュー完了後、S3バケットに自動アップロード
- 複数デバイス間でデータ共有可能
- 事前にAWS設定が必要（[AWS S3設定](#aws-s3への保存設定)を参照）

**保存されるデータ:**
- レビューID
- 問題セット名
- レビューア名と回答
- 正解/不正解の判定
- コメント（入力した場合）
- タイムスタンプ

---

## データのエクスポート

レビュー結果をエクスポートするには、ブラウザの開発者コンソールを使用します。

### 手順

1. **開発者コンソールを開く**
   - Chrome/Edge: `F12` または `Ctrl+Shift+I` (Windows) / `Cmd+Option+I` (Mac)
   - Firefox: `F12` または `Ctrl+Shift+K` (Windows) / `Cmd+Option+K` (Mac)
   - Safari: `Cmd+Option+C` (Macのみ、開発者メニューを有効化する必要があります)

2. **コンソールタブを選択**

3. **エクスポートコマンドを実行**

   **JSON形式でエクスポート:**
   ```javascript
   StorageManager.exportToJSON()
   ```

   **CSV形式でエクスポート:**
   ```javascript
   StorageManager.exportToCSV()
   ```

4. **ファイルがダウンロードされます**
   - ファイル名: `review_results_YYYYMMDD_HHMMSS.json` または `.csv`

### データの確認

**すべての結果を表示:**
```javascript
StorageManager.getAllResults()
```

**統計情報を表示:**
```javascript
StorageManager.getStatistics()
```

**データをクリア:**
```javascript
StorageManager.clearAll()
```

---

## 問題セットの追加

新しい問題セットを追加する場合：

1. **フォルダを作成**
   ```
   qareview_sample/
   ├── tooltest003/         # 新しい問題セット
   │   ├── dgpowerpoint_ja-fs8.png
   │   ├── qa_new_ja.json
   │   └── image.json
   ```

2. **必要なファイル**
   - `dgpowerpoint_ja-fs8.png`: 問題用画像
   - `qa_new_ja.json`: 問題データ（配列形式）
   - `image.json`: 画像のメタデータ

3. **index.htmlを更新**

   `index.html` の問題セットカードセクションに新しいカードを追加：

   ```html
   <div class="problem-set-card" data-set="tooltest003">
       <h3>問題セット 3</h3>
       <p>tooltest003</p>
       <button class="btn-primary" onclick="startReview('tooltest003')">この問題セットを開始</button>
   </div>
   ```

4. **GitHubにプッシュ**
   ```bash
   git add .
   git commit -m "Add tooltest003 problem set"
   git push
   ```

---

## トラブルシューティング

### 問題: 画像が表示されない

**原因**: ファイルパスが正しくない、またはCORS制限

**解決策**:
- ローカルサーバーを使用しているか確認
- ファイル名が `dgpowerpoint_ja-fs8.png` と一致しているか確認
- GitHub Pagesで公開している場合は、リポジトリが公開設定になっているか確認

### 問題: 問題データが読み込めない

**原因**: JSONファイルの形式エラー、またはファイルパスが間違っている

**解決策**:
- `qa_new_ja.json` が正しいJSON配列形式か確認
- ブラウザの開発者コンソールでエラーメッセージを確認
- JSONファイルのパスが正しいか確認

### 問題: レビュー結果が保存されない

**原因**: ローカルストレージの容量制限、またはブラウザの設定

**解決策**:
- ブラウザのローカルストレージを確認（開発者ツール → Application → Local Storage）
- データが多すぎる場合は、エクスポートしてからクリア
- プライベートブラウジングモードを使用していないか確認

### 問題: GitHub APIからデータを取得できない

**原因**: APIレート制限、またはリポジトリがプライベート

**解決策**:
- リポジトリが公開されているか確認
- GitHub APIのレート制限（60リクエスト/時間）を超えていないか確認
- 認証トークンを使用する場合は、適切に設定されているか確認

---

## AWS S3への保存設定

レビュー結果をAWS S3バケットに保存する場合の設定手順です。

### 前提条件

- AWSアカウント
- 基本的なAWSの知識

### ステップ1: S3バケットの作成

1. **AWSコンソールにログイン**
   - https://console.aws.amazon.com/ にアクセス

2. **S3サービスを開く**
   - 検索バーで「S3」と入力し、S3サービスを選択

3. **バケットを作成**
   - 「バケットを作成」ボタンをクリック
   - **バケット名**: 例 `qareview-results-yourname`（グローバルに一意な名前が必要）
   - **リージョン**: 例 `ap-northeast-1`（東京リージョン）
   - **ブロックパブリックアクセス**: すべてのパブリックアクセスをブロック（チェックを入れる）
   - 「バケットを作成」をクリック

4. **フォルダ構造を作成（オプション）**
   - 作成したバケット内に `results/` フォルダを作成

### ステップ2: CORS設定

ブラウザからS3にアクセスできるようにCORS設定を行います。

1. **バケットを選択**
   - 作成したバケットをクリック

2. **アクセス許可タブを開く**
   - 「アクセス許可」タブをクリック

3. **CORS設定を編集**
   - 下にスクロールして「クロスオリジンリソース共有 (CORS)」セクションを見つける
   - 「編集」ボタンをクリック

4. **以下のJSON設定を貼り付け**

   ```json
   [
       {
           "AllowedHeaders": ["*"],
           "AllowedMethods": ["PUT", "POST", "GET"],
           "AllowedOrigins": ["*"],
           "ExposeHeaders": ["ETag"]
       }
   ]
   ```

   **注意**: 本番環境では、`AllowedOrigins`を特定のドメイン（例: `https://yourusername.github.io`）に限定することを推奨します。

5. **変更を保存**

### ステップ3: IAMユーザーの作成と認証情報の取得

1. **IAMサービスを開く**
   - AWSコンソールの検索バーで「IAM」と入力

2. **新しいユーザーを作成**
   - 左サイドバーの「ユーザー」をクリック
   - 「ユーザーを作成」ボタンをクリック
   - **ユーザー名**: 例 `qareview-app-user`
   - 「次へ」をクリック

3. **アクセス許可を設定**
   - 「ポリシーを直接アタッチ」を選択
   - 「ポリシーの作成」をクリック

4. **カスタムポリシーを作成**
   - 「JSON」タブをクリック
   - 以下のポリシーを貼り付け（バケット名を実際の名前に置き換える）:

   ```json
   {
       "Version": "2012-10-17",
       "Statement": [
           {
               "Effect": "Allow",
               "Action": [
                   "s3:PutObject",
                   "s3:PutObjectAcl",
                   "s3:GetObject"
               ],
               "Resource": "arn:aws:s3:::qareview-results-yourname/*"
           }
       ]
   }
   ```

   - 「次へ」をクリック
   - **ポリシー名**: 例 `QAReviewS3WritePolicy`
   - 「ポリシーの作成」をクリック

5. **ユーザーにポリシーをアタッチ**
   - ユーザー作成画面に戻る
   - 作成したポリシー `QAReviewS3WritePolicy` を検索して選択
   - 「次へ」→「ユーザーの作成」をクリック

6. **アクセスキーを作成**
   - 作成したユーザーをクリック
   - 「セキュリティ認証情報」タブを開く
   - 「アクセスキーを作成」をクリック
   - **ユースケース**: 「ローカルコード」を選択
   - 「次へ」→「アクセスキーを作成」をクリック

7. **認証情報を保存**
   - **アクセスキーID**: `AKIA...` のような文字列
   - **シークレットアクセスキー**: `...` のような文字列
   - **重要**: この画面を閉じると二度と表示されないので、必ず保存してください

### ステップ4: アプリケーションの設定

1. **設定ファイルを作成**

   プロジェクトのルートに `config.js` ファイルを作成:

   ```javascript
   // AWS S3設定
   const AWS_CONFIG = {
       enabled: true,  // S3保存を有効化
       region: 'ap-northeast-1',  // あなたのリージョン
       bucketName: 'qareview-results-yourname',  // あなたのバケット名
       accessKeyId: 'AKIA...',  // ステップ3で取得したアクセスキーID
       secretAccessKey: '...',  // ステップ3で取得したシークレットアクセスキー
       folderPrefix: 'results/'  // バケット内のフォルダ（オプション）
   };
   ```

   **セキュリティ警告**:
   - この方法は認証情報がクライアント側に露出するため、テスト環境のみで使用してください
   - 本番環境では、AWS Cognito や API Gateway + Lambda を使用することを強く推奨します

2. **index.htmlとreview.htmlに設定を読み込む**

   `<head>`セクションに以下を追加:

   ```html
   <script src="config.js"></script>
   ```

3. **動作確認**
   - アプリケーションを起動
   - レビューを実行して完了
   - S3バケットに結果ファイルが保存されていることを確認

### ステップ5: セキュリティのベストプラクティス

1. **認証情報の保護**
   - `config.js`を`.gitignore`に追加してGitにコミットしない
   - 環境変数や AWS Secrets Manager を使用する

2. **本番環境での推奨構成**
   - フロントエンド → API Gateway → Lambda → S3
   - AWS Cognito で認証・認可
   - IAM ロールでアクセス制御

3. **バケットポリシーの最適化**
   - 必要最小限のアクセス権限のみを付与
   - IP制限やVPC制限を検討

### トラブルシューティング

#### エラー: Access Denied

**原因**: IAMポリシーまたはバケットポリシーが正しくない

**解決策**:
- バケット名が正しいか確認
- IAMポリシーのARNが正しいか確認
- CORS設定が正しいか確認

#### エラー: CORS policy

**原因**: CORS設定が不足または間違っている

**解決策**:
- CORS設定を再確認
- `AllowedOrigins`にアプリケーションのドメインが含まれているか確認

#### ファイルがアップロードされない

**原因**: アクセスキーが無効または期限切れ

**解決策**:
- アクセスキーIDとシークレットキーを再確認
- ブラウザのコンソールでエラーメッセージを確認

---

## サポート

問題が発生した場合や質問がある場合は、以下の方法でお問い合わせください：

- GitHubのIssuesを作成
- プロジェクト管理者に連絡

---

## ライセンス

このプロジェクトは内部使用を目的としています。

---

**最終更新**: 2025-10-23
